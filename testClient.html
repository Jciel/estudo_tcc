<html>
<head>
    <title>WebSocket</title>

    <style type="text/css">
        #log {
            width:600px;
            height:300px;
            border:1px solid #7F9DB9;
            overflow:auto;
            padding:10px;
        }
        #msg {
            width:300px;
        }
    </style>

    <script type="text/javascript">
        var socket;

        function init() {
            //client
//            var host = "ws://localhost:8080/extruder?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzcxMTAxNTgsImV4cCI6MTUzNzExODc1OCwibmJmIjoxNTM3MTEwMTU3LCJkYXRhIjp7InVzZXIiOiJqb2NpZWwiLCJ0eXBlIjoiY2xpZW50Iiwicm91dGVzIjpbImV4dHJ1ZGUiXX19.BgFy5HG9Bq84z0nWnlnrYjALGE_TXi8ABFHKEthHfUI";
            var host = "ws://localhost:8080/extruder?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzcxMTg1ODMsImV4cCI6MTUzNzExODU5MywibmJmIjoxNTM3MTE4NTgyLCJkYXRhIjp7InVzZXIiOiJqb2NpZWwiLCJ0eXBlIjoiY2xpZW50Iiwicm91dGVzIjpbImV4dHJ1ZGUiXX19.mlDIF5KAtqbWvMW_fsSemk7CN98PPRJODwh3_jC5Wdw";
//            var host = "ws://localhost:8080/extruder?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzcxMTcyNDQsImV4cCI6MTUzNzEyNTg0NCwibmJmIjoxNTM3MTE3MjQzLCJkYXRhIjp7InVzZXIiOiJtYXJpYSIsInR5cGUiOiJjbGllbnQiLCJyb3V0ZXMiOlsiZXh0cnVkZSJdfX0.SP0xS-p-Vl21wt3g3oaYlqIURqcohFQL5rHkHhur_qo";
            //equipament
//            var host = "ws://localhost:8080/extruder?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE1MzcxMTAyNDAsImV4cCI6MTUzNzExODg0MCwibmJmIjoxNTM3MTEwMjM5LCJkYXRhIjp7InVzZXIiOiJleHRydXNvcmEiLCJ0eXBlIjoiZXF1aXBhbWVudCIsInJvdXRlcyI6WyJleHRydWRlIl19fQ.NggINIoHNiLJWXi5CR1qGD5CWFHVRVmXls49DNbIsQc";
//            var host = "ws://localhost:8080/login";

            try
            {
                socket = new WebSocket(host);
                console.log('WebSocket - status ' + socket.readyState);

                socket.onopen = function(msg)
                {
                    if(this.readyState == 1)
                    {
                        console.log("We are now connected to websocket server. readyState = " + this.readyState);
                    }
                };

                //Message received from websocket server
                socket.onmessage = function(msg)
                {
                    console.log(" [ + ] Received: " + msg.data);
                };

                //Connection closed
                socket.onclose = function(msg)
                {
                    console.log("Disconnected - status " + this.readyState);
                };

                socket.onerror = function()
                {
                    console.log("Some error");
                }
            }

            catch(ex)
            {
                console.log('Some exception : '  + ex);
            }

            $("msg").focus();
        }

        function send()
        {
            var txt, msg;
            txt = $("msg");
            msg = txt.value;

            if(!msg)
            {
                alert("Message can not be empty");
                return;
            }

            txt.value="";
            txt.focus();

            try
            {
                console.log(msg);
                socket.send(msg);
                log('Sent : ' + msg);
            }
            catch(ex)
            {
                log(ex);
            }
        }

        function quit()
        {
            if (socket != null)
            {
                log("Goodbye!");
                socket.close();
                socket=null;
            }
        }

        function reconnect()
        {
            quit();
            init();
        }

        // Utilities
        function $(id)
        {
            return document.getElementById(id);
        }

        function log(msg)
        {
            $('log').innerHTML += '<br />' + msg;
            $('log').scrollTop = $('log').scrollHeight;
        }

        function onkey(event)
        {
            if(event.keyCode==13)
            {
                send();
            }
        }
    </script>

</head>

<body onload="init()">

<h3>WebSocket</h3>

<div id="log"></div>

Enter Message <input id="msg" type="textbox" onkeypress="onkey(event)"/>

<button onclick="send()">Send</button>
<button onclick="quit()">Quit</button>
<button onclick="reconnect()">Reconnect</button>

</body>
</html>
